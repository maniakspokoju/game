<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Mini Gra QR</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #scanner { display: none; margin-top: 10px; }
    #message { font-weight: bold; margin-top: 10px; }
    #start-btn { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Mini Gra QR</h1>
  <div id="setup">
    <p>Czy jesteś gotowy?</p>
    <button id="start-btn">Start gry</button>
  </div>

  <div id="game" style="display:none;">
    <p id="next-code">Kolejny kod do zeskanowania: </p>
    <div id="scanner"></div>
    <p id="message"></p>
    <p>Punkty: <span id="score">0</span></p>
  </div>

  <script>
    const codes = ['A','B','C']; // dostępne kody QR w grze
    let activeCode = null;        // aktualny kod do zeskanowania
    let history = [];             // historia ruchów
    let score = 0;                // punkty gracza
    let scanning = false;         // flaga aktywnego skanera
    const maxPoints = 5;          // ile punktów zdobywamy do końca gry
    const startCode = "START";    // kod startowy/stop
    const scannerDiv = document.getElementById("scanner");
    const messageEl = document.getElementById("message");
    const nextCodeEl = document.getElementById("next-code");
    const scoreEl = document.getElementById("score");

    // Funkcja losująca kolejny kod (nie taki sam jak poprzedni)
    function pickNextCode() {
      let options = codes.filter(c => c !== activeCode);
      activeCode = options[Math.floor(Math.random() * options.length)];
      nextCodeEl.innerText = "Kolejny kod do zeskanowania: " + activeCode;
    }

    function updateScore() {
      scoreEl.innerText = score;
    }

    // Start gry
    document.getElementById("start-btn").addEventListener("click", () => {
      document.getElementById("setup").style.display = "none";
      document.getElementById("game").style.display = "block";
      pickNextCode();
      startScanner();
    });

    function startScanner() {
      if (scanning) return;
      scanning = true;
      scannerDiv.style.display = "block";

      const html5QrCode = new Html5Qrcode("scanner");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrMessage => {
          handleScan(qrMessage.toUpperCase());
        },
        errorMessage => {}
      ).catch(err => alert("Nie udało się uruchomić skanera: " + err));
    }

    function handleScan(scanned) {
      if (scanned === startCode) {
        messageEl.innerText = "Koniec gry! Zdobyte punkty: " + score;
        scannerDiv.style.display = "none";
        scanning = false;
        return;
      }

      if (scanned === activeCode) {
        score++;
        history.push(activeCode);
        updateScore();
        if (score >= maxPoints) {
          messageEl.innerText = "Gratulacje! Zdobyłeś " + score + " punktów!";
          scannerDiv.style.display = "none";
          scanning = false;
          return;
        }
        pickNextCode();
        messageEl.innerText = "Poprawnie! Szukaj kolejnego kodu.";
      } else {
        messageEl.innerText = "Skanujesz niewłaściwy kod, szukaj dalej...";
      }
    }
  </script>
</body>
</html>
