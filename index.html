<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Gra QR + Quiz - etap 8.1</title>
<style>
  body { font-family: Arial; text-align: center; }
  #timer { font-size: 48px; margin: 10px; }
  #nextCode { font-size: 48px; font-weight: bold; color: red; }
  #history { font-size: 32px; margin: 10px; }
  button { font-size: 24px; margin: 5px; }
</style>
</head>
<body>

<h1>Gra QR + Quiz - etap 8.1</h1>

<div id="timer">--</div>
<div id="nextCode"></div>
<div id="history"></div>
<div id="points"></div>

<div id="quiz"></div>
<div id="scanner" style="display:none;">
  <p>ðŸ“· Symulacja skanu QR</p>
  <button onclick="scanCorrect()">Zeskanuj poprawny kod</button>
</div>

<script>
/* =======================
   STAN GRY
======================= */
let gameState = "QUIZ"; // QUIZ | SCAN | SUCCESS | FAIL | END
let points = 0;
let maxPoints = 5;

let codes = ["A","B","C","D","E","F"];
let history = [];
let currentCode = null;

let timer = null;
let timeLeft = 5;

/* =======================
   START
======================= */
startGame();

function startGame() {
  nextRound();
}

/* =======================
   RUNDA
======================= */
function nextRound() {
  stopTimer();
  generateNextCode();
  generateQuiz();
  gameState = "QUIZ";
  updateUI();
}

/* =======================
   QUIZ
======================= */
function generateQuiz() {
  const a = rand(), b = rand(), c = rand(), d = rand();
  const ops = ["+","-","*","/"];
  const op1 = ops[rand(0,3)], op2 = ops[rand(0,3)];

  const left = evalExpr(a,op1,b);
  const right = evalExpr(c,op2,d);

  let correct;
  if (left > right) correct = ">";
  else if (left < right) correct = "<";
  else correct = "=";

  const quiz = document.getElementById("quiz");
  quiz.innerHTML = `
    <h2>${a} ${op1} ${b} ? ${c} ${op2} ${d}</h2>
    <button onclick="answerQuiz('<', '${correct}')">&lt;</button>
    <button onclick="answerQuiz('=', '${correct}')">=</button>
    <button onclick="answerQuiz('>', '${correct}')">&gt;</button>
  `;
}

function answerQuiz(choice, correct) {
  if (choice === correct) {
    startScanPhase();
  } else {
    fail();
  }
}

/* =======================
   SKAN
======================= */
function startScanPhase() {
  gameState = "SCAN";
  document.getElementById("quiz").innerHTML = "";
  document.getElementById("scanner").style.display = "block";
  startTimer(5);
  updateUI();
}

function scanCorrect() {
  if (gameState !== "SCAN") return;
  success();
}

/* =======================
   SUKCES / FAIL
======================= */
function success() {
  stopTimer();
  gameState = "SUCCESS";
  history.push(currentCode);
  points++;

  if (points >= maxPoints) {
    gameState = "END";
    updateUI();
    return;
  }

  setTimeout(nextRound, 800);
}

function fail() {
  stopTimer();
  gameState = "FAIL";
  if (history.length > 0) {
    history.pop();
    points--;
  }
  setTimeout(nextRound, 800);
}

/* =======================
   TIMER
======================= */
function startTimer(seconds) {
  timeLeft = seconds;
  document.getElementById("timer").textContent = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if (timeLeft <= 0) fail();
  }, 1000);
}

function stopTimer() {
  clearInterval(timer);
  timer = null;
  document.getElementById("timer").textContent = "--";
}

/* =======================
   UI
======================= */
function updateUI() {
  document.getElementById("nextCode").textContent =
    gameState === "SCAN" ? `Skanuj: ${currentCode}` : "";

  document.getElementById("history").textContent =
    "Historia: " + history.join(" > ");

  document.getElementById("points").textContent =
    "Punkty: " + points;

  document.getElementById("scanner").style.display =
    gameState === "SCAN" ? "block" : "none";

  if (gameState === "END") {
    alert("KONIEC GRY");
  }
}

/* =======================
   POMOCNICZE
======================= */
function generateNextCode() {
  let next;
  do {
    next = codes[Math.floor(Math.random()*codes.length)];
  } while (next === currentCode);
  currentCode = next;
}

function rand(min=1,max=9) {
  return Math.floor(Math.random()*(max-min+1))+min;
}

function evalExpr(a,op,b) {
  if (op === "/" && b === 0) return Infinity;
  return eval(`${a}${op}${b}`);
}
</script>

</body>
</html>
